<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>report</title><link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:first-child { margin-top: -20px; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 2; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px !important; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0px; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="mermaid"] svg, [lang="flow"] svg { max-width: 100%; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root { --side-bar-bg-color: #fafafa; --control-text-color: #777; }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 30px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 2px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border: 0px none; overflow: hidden; box-sizing: content-box; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(223, 226, 229); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
table tr { border-top: 1px solid rgb(223, 226, 229); margin: 0px; padding: 0px; }
table tr:nth-child(2n), thead { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border-width: 1px 1px 0px; border-top-style: solid; border-right-style: solid; border-left-style: solid; border-top-color: rgb(223, 226, 229); border-right-color: rgb(223, 226, 229); border-left-color: rgb(223, 226, 229); border-image: initial; border-bottom-style: initial; border-bottom-color: initial; text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(223, 226, 229); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-lines { padding-left: 4px; }
.code-tooltip { box-shadow: rgba(0, 28, 36, 0.3) 0px 1px 1px 0px; border-top: 1px solid rgb(238, 242, 242); }
.md-fences, code, tt { border: 1px solid rgb(231, 234, 237); background-color: rgb(248, 248, 248); border-radius: 3px; padding: 2px 4px 0px; font-size: 0.9em; }
code { background-color: rgb(243, 244, 244); padding: 0px 2px; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.md-task-list-item > input { margin-left: -1.3em; }
@media print {
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
.md-mathjax-midline { background: rgb(250, 250, 250); }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border-radius: 3px; padding: 2px 0px 0px 4px; font-size: 0.9em; color: inherit; }
.md-tag { color: rgb(167, 167, 167); opacity: 1; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
.sidebar-tabs { border-bottom: none; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.12); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }
.file-node-content:hover .file-node-icon, .file-node-content:hover .file-node-open-state { visibility: visible; }
.mac-seamless-mode #typora-sidebar { background-color: var(--side-bar-bg-color); }
.md-lang { color: rgb(180, 101, 77); }
.html-for-mac .context-menu { --item-hover-bg-color: #E6F0FE; }
#md-notification .btn { border: 0px; }
.dropdown-menu .divider { border-color: rgb(229, 229, 229); }




@page { margin: 10%; }
.typora-export #write { padding: 0px !important; max-width: 1200px !important; margin-right: 0mm !important; margin-left: 0mm !important; }

 .typora-export li, .typora-export p, .typora-export,  .footnote-line {white-space: normal;} 
</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-n825' class='md-header-anchor '></a>[Notes]</h1><blockquote><ul><li>réflexion sur la mission et la manière dont vous vous êtes organisés</li><li>réflexion sur les choix qui ont été faits</li><li>réflexion sur la portée de vos réalisations, leurs avantages et inconvénients, leur devenir dans l&#39;entreprise</li><li>philosophie de l&#39;open-source (contributions dans les 2 sens)</li></ul><p>Résumé : web-mining, open source</p></blockquote><hr /><h2><a name='header-n841' class='md-header-anchor '></a>title: Document Center</h2><h1><a name='header-n842' class='md-header-anchor '></a>Remerciements</h1><p>Je tiens tout d&#39;abord à remercier Guillaume Plique et Benjamin Ooghe-Tabanou pour leur très grande disponibilité tout au long du stage et pour tout ce que j&#39;ai appris grâce à eux. Effectuer mon premier stage avec un tuteur du niveau de compétences et de pédagogie de Guillaume</p><p>Je remercie Paul et l&#39;équipe de m&#39;avoir fait confiance pour ce stage.</p><p>Merci à Barbara, Damien, Robin, Arnaud, Donato, Léna ainsi que toute l&#39;équipe auprès de qui travailler pendant ces six mois fut un plaisir.</p><p>&nbsp;</p><p>// REDIGER REMERCIEMENTS DETAILLES</p><h1><a name='header-n848' class='md-header-anchor '></a>Sommaire</h1><ul><li><p><a href='#notes'>[Notes]</a></p></li><li><p><a href='#header-n842'>Remerciements</a></p></li><li><p><a href='#header-n848'>Sommaire</a></p></li><li><p><a href='#header-n909'>Résumé technique</a></p></li><li><p><a href='#header-n912'>Introduction</a></p></li><li><p><a href='#1-un-m%C3%A9dialab-%C3%A0-sciencespo-'>1. Un Médialab à SciencesPo ?</a></p><ul><li><a href='#11-un-laboratoire-un-peu-particulier'>1.1 Un laboratoire un peu particulier</a></li><li><a href='#12-l%C3%A9quipe'>1.2 L&#39;équipe</a></li></ul></li><li><p><a href='#2-ma-mission'>2. Ma mission</a></p><ul><li><a href='#21-le-sujet'>2.1 Le sujet</a></li><li><a href='#22-le-planning'>2.2 Le planning</a></li><li><a href='#23-mes-contributions'>2.3 Mes contributions</a></li><li><a href='#24-outils--technologies'>2.4 Outils &amp; technologies</a></li><li><a href='#25-prise-de-recul'>2.5 Prise de recul</a></li></ul></li><li><p><a href='#3-le-travail-r%C3%A9alis%C3%A9'>3. Le travail réalisé</a></p><ul><li><p><a href='#31-collecter'>3.1 Collecter</a></p><ul><li><a href='#311-twitter'>3.1.1 Twitter</a></li><li><a href='#312-facebook'>3.1.2 Facebook</a></li><li><a href='#313-pages-web'>3.1.3 Pages web</a></li></ul></li><li><p><a href='#32-traiter'>3.2 Traiter</a></p><ul><li><a href='#321-normalisation-des-urls'>3.2.1 Normalisation des urls</a></li><li><a href='#322-extraction-du-contenu-pertinent-dune-page-web'>3.2.2 Extraction du contenu pertinent d&#39;une page web</a></li><li><a href='#header-n1175'>Minet</a></li></ul></li></ul></li><li><p><a href='#header-n1186'>Conclusion</a></p></li><li><p><a href='#header-n1190'>Bibliographie</a></p></li><li><p><a href='#header-n1193'>Glossaire</a></p></li><li><p><a href='#header-n1204'>Annexes</a></p></li></ul><h1><a name='header-n909' class='md-header-anchor '></a>Résumé technique</h1><p>Mon stage a principalement consisté en l&#39;amélioration d&#39;outils et de librairies destinées à répondre aux besoins de chercheurs traitant de grandes masses de données issues du web. Les développements ont été principalement réalisés en Python.</p><p>// RESUME TECHNIQUE</p><h1><a name='header-n912' class='md-header-anchor '></a>Introduction</h1><p>// INTRODUCTION</p><p>&nbsp;</p><h1><a name='header-n915' class='md-header-anchor '></a>1. Un Médialab à SciencesPo ?</h1><h2><a name='header-n916' class='md-header-anchor '></a>1.1 Un laboratoire un peu particulier</h2><p>Le Médialab est un des 10 centres de recherche de SciencesPo. Laboratoire numérique, le Médialab a été fondé en 2009 par le sociologue et philosophe <a href='https://fr.wikipedia.org/wiki/Bruno_Latour'>Bruno Latour</a> pour aider les sciences sociales et humaines à tirer le meilleur profit de la masse de données rendues disponibles par la numérisation. Comment perçoit-on/utilise-t-on les données numériques dans la société ? Qu&#39;en fait-on ? Quels outils peut-on créer pour les collecter, les étudier, les exploiter, les visualiser, dans des domaine aussi variés que la sociologie, l&#39;histoire, l&#39;art, l&#39;ingénierie, le design et la pédagogie ?
Il en ressort des productions de types très variés et peu courants pour un laboratoire de sciences sociales : aux traditionnels &quot;papiers&quot; s&#39;ajoutent des applis, des outils de collecte, d&#39;exploration, de visualisation des données...</p><p>Constituée d&#39;une trentaine de personnes, son équipe se distingue de celles des autres laboratoires de SciencesPo par sa grande diversité : chercheurs en sciences sociales, designers, ingénieurs pédagogiques et développeurs s&#39;y côtoient.</p><p>Parmi les projets du laboratoire, on peut citer <a href='https://www.lafabriquedelaloi.fr'>La Fabrique de la Loi</a> qui propose une visualisation graphique  et détaillée des procédures parlementaires, le projet <a href='https://medialab.github.io/datapol/app/#!/'>Datapol</a> qui analyse les données numériques de la campagne présidentielle de 2017, ou <a href='https://dime-shs.sciencespo.fr/instruments/dime-web/'>Dime Web</a>, qui vise à établir un ensemble d&#39;outils open source permettant de collecter des données sur le web et sur les réseaux sociaux (Twitter notamment).</p><p>On peut citer comme laboratoires similaires le <a href='https://wiki.digitalmethods.net/'>Digital Methods Initiative</a> d&#39;Amsterdam , l&#39;<a href='https://www.oii.ox.ac.uk/'>Oxford Internet Institute</a>, le <a href='https://www.tantlab.aau.dk/'>TANT-Lab</a> danois, ainsi que le <a href='https://civic.mit.edu/'>MIT Center for Civic Media</a> et le <a href='https://cyber.harvard.edu/'>Berkman Klein Center for Internet &amp; Society</a>, qui travaillent notamment sur la suite d&#39;outils <a href='https://mediacloud.org/'>Media Cloud</a> répondant aux mêmes types de problématiques abordées par le Médialab. Ces deux laboratoires américains diffèrent cependant du Médialab sur certains points, notamment l&#39;effectif - le Berkman Klein Center compte plus de 200 personnes - et les financements - le médialab du MIT est financé entièrement par des sponsors.</p><h2><a name='header-n921' class='md-header-anchor '></a>1.2 L&#39;équipe</h2><blockquote><p>// A REDIGER</p><p>Paul, Guillaume, Benjamin, Jean-Philippe, Robin, Donato, Damien, Audrey, Diego</p></blockquote><p>L&#39;équipe technique du laboratoire se compose d&#39;un directeur technique (Paul Girard), d&#39;ingénieurs de recherche, de designers et de développeurs. L&#39;organisation est très horizontale, et aucune hiérarchie ne transparaît au quotidien, les décisions étant prises en collectif, lors des réunions hebdomadaires et des conseils de laboratoires.</p><p>J&#39;ai principalement travaillé avec deux ingénieurs de recherche : mon tuteur Guillaume Plique et Benjamin Ooghe-Tabanou, présents quotidiennement dans le même bureau que le mien.</p><blockquote><p><em>Donneurs d&#39;ordre ? Comment l&#39;info circule-t-elle ?</em></p></blockquote><p>Les objectifs de long terme sont déterminés en commun avec mon tuteur, tandis que les tâches annexes et ponctuelles, comme le traitement d&#39;un corpus spécifique, sont principalement définies par mail ou de vive-voix.</p><blockquote><p><em>Technologies maîtrisées par l&#39;équipe ?</em></p></blockquote><p>La très grande majorité des outils développés par le laboratoire le sont en Python ou en Javascript. Des frameworks comme React sont utilisés, ainsi que des outils de déploiement et d&#39;intégration comme Gitlab CI, Docker, Rancher. Tous les outils développés le sont en open-source, et sont publiés sur le <a href='https://github.com/medialab'>repo du laboratoire</a> le plus souvent sous licence AGPL-3.0, GPL-3.0 ou MIT.</p><blockquote><p><em>Méthodes et outils utilisés (agile, git) ? Validation des développements (tests) ?</em></p></blockquote><p>L&#39;équipe s&#39;organise d&#39;une part via une réunion hebdomadaire de tous les membres du laboratoire, où l&#39;on partage les avancées et projets de chacun et où ont lieux des réflexions plus larges et globales sur le laboratoire, et d&#39;autre part via la réunion technique, bimensuelle. C&#39;est pendant cette réunion technique que sont gérés les projets en cours et à suivre, via une méthode agile.</p><h1><a name='header-n936' class='md-header-anchor '></a>2. Ma mission</h1><h2><a name='header-n937' class='md-header-anchor '></a>2.1 Le sujet</h2><blockquote><p><em>Sujet initial</em></p></blockquote><p>Dans le cadre d&#39;un projet de recherche de <a href='https://fr.wikipedia.org/wiki/Dominique_Cardon_(sociologue)'>Dominique Cardon</a> étudiant la polarisation de l&#39;espace médiatique numérique français, le stage porte sur les techniques de récolte de données web (sites, réseaux sociaux) et de visualisation de celles-ci. </p><p>La <em>polarisation de l&#39;espace médiatique</em> ? Pour saisir les intentions de ce projet de recherche, il faut partir d&#39;une étude du <a href='(https://cyber.harvard.edu/)'>Berkman Klein Center for Internet &amp; Society</a> sur la campagne présidentielle américaine de 2016. En étudiant la façon dont les médias s&#39;intercitent et la façon dont ils sont partagés en ligne, le laboratoire a conclu à une très forte polarisation, où d&#39;un côté la gauche et le centre se rapprochent quand de l&#39;autre la droite s&#39;éloigne un peu plus vers la droite.  Il s&#39;agit en quelque sorte de vérifier de façon empirique, sur de grandes quantitées de données, des hypothèses sociologiques.</p><p>Le but de ce projet de recherche du Médialab, qu&#39;on appellera le projet <em>Polarisation</em> dans la suite, est de répliquer cette analyse sur l&#39;espace médiatique français. Comment une polémique d&#39;actualité comme l&#39;affaire Benalla se diffuse au travers des différents médias ? Les mêmes thèmes sont-ils abordés partout ? </p><p>Concrètement, cette polarisation s&#39;étudie via la construction de réseaux : on peut par exemple établir un graphe de médias à partir des partages de liens sur les réseaux sociaux. Ainsi, deux médias seront liés si le même profil de personnes les partagent. Un tel graphe permet ensuite d&#39;identifier des groupes, ou pôles, dans l&#39;espace médiatique.</p><p><img src='data/reseau_tweets.png' alt='reseau_tweets' referrerPolicy='no-referrer' /></p><blockquote><p>[ Répliquer une étude du Berkman Center : intercitation des médias, comment les gens partagent ces médias, informations révélées apr le réseau, vérifier des hyptohèses sociologiques, Benalla : comment les thèmes d&#39;un sujet se diffusent au travers des différents médias, légitimité des médias ?, </p><p>Hypothèse de l&#39;institut Montaigne : aux US grosse polarisation des médias (gauche/droite assez hermétiques), qui s&#39;accentue (Berkman). Hypothèse du directeur de Berkman : la droite s&#39;éloigne (jeu dégueulasse) et le centre</p><p>Même chose en France : globalement oui, mais bien moins dramatique. Médias alternatifs très peu considérés </p><p>Polarisation : réseaux de co-occurence de tweets (réseau bipartite : 2 types de noeuds : un utilisateur partage un média n fois) réseau de similarité de média par le truchement des utilisateurs</p><p>Chaque média est un vecteur de ses utilisateurs -&gt; similarité cosinus</p><p>Deux médias seront liés s&#39;ils ont un profil de gens qui les partagent similaire</p><p>Problème : on finit par prouver des trucs qu&#39;on savait déjà depuis longtemps en socio]</p></blockquote><p>Afin d&#39;établir ce genre de visualisations, il est nécessaire de collecter et de traiter les données du corpus étudié. </p><blockquote><p><em>Ses évolutions (et leurs causes)</em></p></blockquote><p>Les besoins de collecte et de traitement de données étant multiples, j&#39;ai été amené à travailler sur plusieurs outils, répondant chacun à un besoin particulier mais relevant du domaine du web-mining : collecter de grandes quantités de tweets, récupérer des données de partages Facebook, extraire le contenu pertinent d&#39;une page web, normaliser des urls.</p><blockquote><p><em>Situer le sujet dans les objectifs du labo</em></p></blockquote><p>Un des objectifs du laboratoire en termes de collecte de données est d&#39;élargir son spectre de sources : les données récoltées proviennent actuellement de pages web (via le <em>crawler</em> <a href='https://github.com/medialab/hyphe'>Hyphe</a>) et de Twitter (via l&#39;outil <a href='https://github.com/medialab/gazouilloire'>Gazouilloire</a>). Une partie importante de l&#39;espace médiatique numérique échappe donc aux outils du laboratoire : Facebook, LinkedIn, Instagram par exemple. </p><blockquote><p><em>Cahier des charges précis ou participation à son élaboration ?</em></p></blockquote><p>&nbsp;</p><p>&nbsp;</p><h2><a name='header-n964' class='md-header-anchor '></a>2.2 Le planning</h2><blockquote><p><em>Vous pouvez présenter le planning initial et le planning réel avec les dates importantes.
Quelles ont été les étapes importantes ? Indiquez celles qui auraient été les plus difficiles, les plus intéressantes, etc.</em></p></blockquote><p>Itérations de 2 semaines.</p><h2><a name='header-n968' class='md-header-anchor '></a>2.3 Mes contributions</h2><blockquote><p><em>Etat du projet à votre arrivée ? Et à la fin ?</em></p><p><em>Avez-vous réalisé une étude, une maquette, une preuve de concept, un produit ou une application complète ? Que reste-t-il à faire pour rendre utilisable votre travail ?</em></p></blockquote><p>&nbsp;</p><h2><a name='header-n973' class='md-header-anchor '></a>2.4 Outils &amp; technologies</h2><blockquote><p><em>Outils, environnements, logiciels</em></p></blockquote><p>Tout le travail effectué l&#39;a été en Python ou en Javascript. En Python, le gestionnaire d&#39;environnement virtuels pyenv a été utilisé, pour compartimenter la version de Python et les dépendances propres à chaque projet. </p><p>Concernant les bases de données, ont été utilisés Elasticsearch (ainsi que son interface de visualisation et de monitoring Kibana) et MongoDB.</p><p>Pour le développement d&#39;interfaces, React et material-ui ont été plébiscités, ainsi que Recharts pour la visualisation de données.</p><blockquote><p><em>Comment les développements ont été vérifiés/testés/validés ?</em></p></blockquote><p>La plupart des librairies comportent des tests unitaires, qui sont vérifiés grâce au logiciel d&#39;intégration continue Travis CI. Les développements de nouvelles fonctionnalités ont été faits sur des branches dédiées sur git, puis envoyés sous forme de Pull Requests avant d&#39;être mergées à la branche master.</p><p>&nbsp;</p><h2><a name='header-n983' class='md-header-anchor '></a>2.5 Prise de recul</h2><blockquote><p><em>Quel a été l&#39;intérêt de votre travail pour l&#39;entreprise ? Que va devenir votre contribution ? Présenter les perspectives.
Quelles sont les améliorations à envisager ? Quelle est la maintenance à prévoir sur cette réalisation ou cette application ?
Selon les cas, présentez vos réflexions sur <strong>l&#39;impact de votre travail sur les utilisateurs</strong>, les nouveaux usages, le respect de la <strong>vie privée</strong> ou de l&#39;environnement...</em></p></blockquote><p>Amélioration d&#39;outils répondant à des besoins récurrents des chercheurs.</p><h1><a name='header-n987' class='md-header-anchor '></a>3. Le travail réalisé</h1><blockquote><p><em>Cette partie est la plus longue ; vous y présenterez votre travail.
Si besoin, vous pourriez structurer le reste du rapport en plusieurs parties et non une seule. La ou les parties devraient elles-mêmes êtres structurées en plusieurs sous-sections au sein d&#39;une même partie. Dans tous les cas, la logique du plan doit apparaître clairement.
Travaillez les liaisons pour aboutir à une lecture fluide. Voici un exemple (un peu exagéré) : &quot;Après avoir inventorié les technologies disponibles dans la section précédente, cette section est consacrée aux expérimentations que nous avons menées avec chacune d&#39;elles. Ce travail nous permettra de sélectionner les technologies retenues, présentées dans la section suivante.&quot;
Présentez votre réflexion et vos choix, qui devraient être justifiés. Examinez rapidement les autres alternatives.
Sélectionnez les détails pertinents et laissez les autres en annexe. Allez du général au particulier. Evitez de présenter un catalogue des fonctions développées.</em></p></blockquote><p>&nbsp;</p><h2><a name='header-n991' class='md-header-anchor '></a>3.1 Collecter</h2><h3><a name='header-n992' class='md-header-anchor '></a>3.1.1 Twitter</h3><h4><a name='header-n993' class='md-header-anchor '></a>3.1.1.1 Fonctionnement de l&#39;outil Gazouilloire</h4><p>Pour récolter des tweets, le laboratoire utilise un outil maison, <a href='https://github.com/medialab/gazouilloire'>Gazouilloire</a>. </p><p>Gazouilloire est un outil de collecte de tweets selon certains critères (mots-clés, hashtag, période, langage...). Imaginons que l&#39;on souhaite étudier la polémique autour de Parcoursup et collecter les tweets liés au sujet ; il suffit de lancer une collecte sur le mot-clé <code>&#39;parcoursup&#39;</code> . En utilisant une clé d&#39;API Twitter (générée via un compte développeur), l&#39;outil va collecter les tweets contenant ce mot-clé, à la fois en direct (<code>stream</code>) et en remontant dans le passé ( <code>search</code> ). L&#39;API Twitter étant limitée à une dizaine de jours de retour dans le passé, un chercheur souhaitant étudier un sujet sur plusieurs semaines ou plusieurs mois devra faire tourner sa collecte sur la durée souhaitée.</p><p>Gazouilloire formate ensuite les champs récupérés pour chaque tweet (plus d&#39;une cinquantaine : contenu texte, hashtags, auteur, date...) et les stocke dans une base de données.</p><p><img src='data/tweet_fields.png' alt='Champs d&#39;un tweet' referrerPolicy='no-referrer' /></p><p>Techniquement, Gazouilloire est un outil écrit en Python 2, faisant appel à une base de données MongoDB.</p><p>Mon travail a d&#39;abord consisté à rendre l&#39;outil compatible Python 3, tout en gardant la compatibilité avec Python 2, puis à migrer vers une base de données Elasticsearch.</p><p>&nbsp;</p><h4><a name='header-n1001' class='md-header-anchor '></a>3.1.1.2 Ébauche d&#39;une interface</h4><h5><a name='header-n1002' class='md-header-anchor '></a>Quels besoins ?</h5><p>Gazouilloire est un outil en ligne de commande, qui se lance donc via un terminal. Les paramètres de la collecte (mots-clés, hashtags, période, ...) sont entrés dans un fichier JSON avant le lancement du programme. Cela le rend difficilement accessible aux chercheurs en sciences sociales qui n&#39;ayant pas de formation en informatique. </p><p>En outre, une interface de visualisation rapide des données stockées dans la base de données serait bienvenue, afin d&#39;identifier des tendances ou de repérer d&#39;éventuels problèmes.</p><p>Enfin, la possibilité de surveiller l&#39;état des collectes directement dans l&#39;interface faciliterait grandement le suivi de celles-ci. </p><h5><a name='header-n1006' class='md-header-anchor '></a>Quelles technologies ?</h5><p>Il faut distinguer les différentes composantes nécessaires au fonctionnement de l&#39;interface de l&#39;application.</p><ul><li>un client, qui gère l&#39;interface graphique (développé en Javascript)</li><li>un serveur simple (développé en Python, grâce au framework Flask)</li><li>une base de données (ici, MongoDB)</li></ul><p><img src='data/clean_webapp_diagram.png' alt='' referrerPolicy='no-referrer' /></p><p><strong>L&#39;interface utilisateur</strong></p><p>Pour le développement de l&#39;interface, le choix d&#39;un librairie comme <a href='https://reactjs.org/'>React</a> se révèle pertinent. Le recours au framework <a href='https://material-ui.com/'>material-ui</a> permet d&#39;utiliser des composants pré-existants à la fois fonctionnels, esthétiques et responsive*. </p><p><img src='data/react_material.png' alt='' referrerPolicy='no-referrer' /></p><p>React est une bibliothèque Javascript libre développée par Facebook qui vise à faciliter la création d&#39;interface d&#39;applications web. Elle est notamment utilisée par Netflix, Yahoo, Airbnb, Sony ainsi que WhatsApp et Instagram (appartenant à Facebook).[^fn1]</p><p>React fonctionne par la création de composants réutilisables, possédant chacun un état pouvant évoluer avec le temps. Avec React a été développé un langage, le <a href='https://reactjs.org/docs/introducing-jsx.html'>JSX</a>, hybride entre Javascript et HTML. Le JSX permet de générer des objets Javascript avec une notation similaire à celle du HTML :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="jsx"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="jsx"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">const</span> <span class="cm-def">element</span> <span class="cm-operator">=</span> <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">h1</span><span class="cm-tag cm-bracket">&gt;</span>Hello, {<span class="cm-variable">name</span>}<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">h1</span><span class="cm-tag cm-bracket">&gt;</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>Une des particularités de React est l&#39;utilisation d&#39;un DOM* virtuel : plutôt que de regénérer tout le DOM à chaque modification de la page, le DOM est représenté comme une arborescence d&#39;objets Javascript, ce qui permet à React de détecter la moindre modification de la page. Une fois la modification identifiée, React interagit avec le DOM pour ne changer que ce qui est nécessaire.</p><p>Dans une perspective d&#39;usages multiples (collecte, analyse et monitoring), l&#39;application se doit de dédier une page (ou onglet) à chacun de ceux-ci. Cela peut se faire via un élément cliquable comme un bouton, dans lequel on indique une url pointant vers la page voulue.</p><p><img src='data/button.png' alt='' referrerPolicy='no-referrer' /></p><p>Il reste à afficher le bon contenu lorsqu&#39;on accède à l&#39;url en question.</p><p>Cela peut se faire grâce à un routeur comme <code>react-router-dom</code> :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="jsx"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="jsx"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> {<span class="cm-def">BrowserRouter</span> <span class="cm-keyword">as</span> <span class="cm-def">Router</span>, <span class="cm-def">Route</span>} <span class="cm-keyword">from</span> <span class="cm-string">'react-router-dom'</span>;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Router</span><span class="cm-tag cm-bracket">&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Route</span> <span class="cm-attribute">path</span>=<span class="cm-string">"/collect"</span> <span class="cm-attribute">component</span>={<span class="cm-variable">CollectPage</span>} <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Route</span> <span class="cm-attribute">path</span>=<span class="cm-string">"/analyze"</span> <span class="cm-attribute">component</span>={<span class="cm-variable">AnalyzePage</span>} <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">Route</span> <span class="cm-attribute">path</span>=<span class="cm-string">"/monitor"</span> <span class="cm-attribute">component</span>={<span class="cm-variable">MonitoringPage</span>} <span class="cm-tag cm-bracket">/&gt;</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">Router</span><span class="cm-tag cm-bracket">&gt;</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p>Ici, <code>CollectPage</code>, <code>AnalyzePage</code> et <code>MonitoringPage</code> sont des composants contenant tous les éléments affichés respectivement sur les pages de collecte, d&#39;analyse et de monitoring.</p><p>On souhaite ici afficher des visualisations de données dans le composant <code>AnalyzePage</code>. Il existe pour cela plusieurs librairies Javascript : <a href='https://d3js.org/'>D3.js</a>, <a href='https://www.chartjs.org/'>Chart.js</a>, <a href='https://gionkunz.github.io/chartist-js/'>Chartist.js</a> ou <a href='http://recharts.org/en-US/'>Recharts</a> pour en citer quelques-unes.</p><p>Le choix s&#39;est ici porté sur Recharts, pour sa logique basée sur des composants React. Recharts se base sur D3.js, largement répandu mais moins évident à utiliser.</p><p>Le choix de Recharts s&#39;est révélé payant pour l&#39;implémentation de graphiques simples (bar charts, pie charts &amp; line charts), mais la personnalisation des composants s&#39;est révélée ardue. Concernant le graphique du nombre de tweets par jour, il m&#39;a fallu manuellement coder une fonction de zoom dynamique (sur une période choisie à la souris) par exemple.</p><p><strong>Le serveur</strong></p><p>Toutes les visualisations présentes dans l&#39;interface ne sont à la base que des données. Il faut donc bien que le client aille chercher ces données quelque part : il va les demander au serveur.</p><p>La mission du serveur est simple : répondre aux requêtes du client avec les données adéquates.</p><p>C&#39;est lui qui va gérer la connexion et les requêtes faites à la base de données, et les renvoyer dans un format adapté au client.</p><p>Le choix s&#39;est porté sur le microframework <a href='http://flask.pocoo.org/'>Flask</a>, pour sa simplicité - il suffit d&#39;un fichier Python - et sa légèreté.</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@app</span>.<span class="cm-property">route</span>(<span class="cm-string">"/timeevolution"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">getDayCount</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">days</span> = [<span class="cm-variable">day</span> <span class="cm-keyword">for</span> <span class="cm-variable">day</span> <span class="cm-keyword">in</span> <span class="cm-variable">mongo</span>.<span class="cm-property">db</span>.<span class="cm-property">tweets</span>.<span class="cm-property">aggregate</span>(<span class="cm-string">"REQUETE D'AGGREGATION PAR DATE"</span>)]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">make_response</span>(<span class="cm-variable">jsonify</span>(<span class="cm-variable">days</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p>Il suffit alors, du côté du client, de faire une requête à la route indiquée pour récupérer les données :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="javascript"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="javascript"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">fetch</span>(<span class="cm-string">'adresse_du_serveur/timeevolution'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><blockquote><p>// Recharts : nb tweets / jour : agrégation Mongo</p></blockquote><p><img src='data/gazou1.png' alt='' referrerPolicy='no-referrer' /></p><p><img src='data/gazou2.png' alt='' referrerPolicy='no-referrer' /></p><p><img src='data/gazou3.png' alt='' referrerPolicy='no-referrer' /></p><p>L&#39;établissement de cette interface de visualisation simple a permis de mettre en avant d&#39;importantes limitations de la configuration actuelle de l&#39;outil. Ces conclusions ont mené à lancer deux chantiers de plus grande ampleur : la migration vers Elasticsearch, et le passage de l&#39;outil de Python 2 à Python 3.</p><h4><a name='header-n1047' class='md-header-anchor '></a>3.1.1.3 Comment passer de Python 2 à Python 3 ?</h4><p>Le support de Python 2 s&#39;arrêtant officiellement en 2020, et Python 2 étant une source de problèmes éventuels (d&#39;encodage, de compatibilité si intégration de nouvelles dépendances/librairies), la migration vers Python 3 s&#39;impose. On souhaite cependant conserver une pleine compatibilité avec Python 2, pour éviter tout <em>breaking-change*</em>.</p><p><strong>Futurize</strong></p><p>Basé sur les librairies <a href='https://docs.python.org/2/library/2to3.html'>2to3</a>, <a href='https://pypi.org/project/3to2/'>3to2</a> et <a href='https://python-modernize.readthedocs.io/en/latest/'>python-modernize</a>, <a href='https://python-future.org/automatic_conversion.html'>futurize</a> est un script du projet <code>python-future</code>, qui vise à assurer une compatibilité Python 2 et 3. <code>python-future</code> s&#39;installe ainsi :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="bash"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pip install future</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>futurize</code> agit en 2 étapes : une première qui ne fait que des changements conservant une compatibilité totale avec Python 2 (parenthèses aux <code>print</code>, division entière, ...). La seconde étape se base sur une dépendance à <code>future</code>. </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="bash"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">futurize <span class="cm-attribute">--stage1</span> <span class="cm-attribute">-w</span> script.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="bash"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">futurize <span class="cm-attribute">--stage2</span> <span class="cm-attribute">--unicode-literals</span> <span class="cm-attribute">-w</span> script.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>L&#39;option <code>-w</code> permet d&#39;appliquer directement les changements nécessaires au fichier, et <code>--unicode-literals</code> permet de considérer par défaut toutes les <code>string</code> comme du texte (<code>str</code> en Python 3, <code>unicode</code> en Python 2), et non du binaire.</p><p><strong>Vérifier le reste à la main</strong></p><p>Habituellement, d&#39;autres problèmes ont besoin d&#39;être résolus avant d&#39;avoir une réelle compatibilité Python 2 &amp; 3 ; typiquement la compatiblité des dépendances elles-mêmes.</p><p>Ici, Gazouilloire fait appel à la librairie <a href='https://github.com/phpdude/python-urlsresolver'>urlsresolver</a>, utilisée pour résoudre les liens raccourcis présents dans les tweets, et stocker les liens réels. qui n&#39;est compatible qu&#39;avec Python 2. </p><p>C&#39;est l&#39;occasion d&#39;expérimenter concrètement ce qu&#39;est le milieu de l&#39;open source libre : le code d&#39;urlsresolver étant accessible à tous sur un repo Github, il est possible de <em>cloner</em>* le repo et d&#39;en modifier le code de son côté.</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="bash"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="bash"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">git</span> clone <span class="cm-builtin">git</span>@github.com:phpdude/python-urlsresolver.git</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>J&#39;ai donc modifié la librairie pôur la rendre compatible Python 3, ajouté des <em>tests unitaires</em>* pour s&#39;assurer que le code reste fonctionnel de Python 2.7 à Python 3.7, et effectué une <em>Pull Request</em>* au créateur de la librairie (<a href='https://github.com/phpdude'>@phpdude</a>). Ce dernier m&#39;a répondu, a étudié ma Pull Request et l&#39;a acceptée, ajoutant ainsi mes modifications à la librairie.</p><p><img src='data/pull_request.png' alt='' referrerPolicy='no-referrer' /></p><blockquote><p>urlsresolver : test Travis</p></blockquote><h4><a name='header-n1065' class='md-header-anchor '></a>3.1.1.4 Migration de MongoDB à Elasticsearch</h4><p><img src='data/mongotoes.png' alt='' referrerPolicy='no-referrer' /></p><h5><a name='header-n1067' class='md-header-anchor '></a>Pourquoi changer de base de données ?</h5><p>MongoDB est un système de bases de données non-relationnelles, très souple à l&#39;usage : nul besoin de spécifier à l&#39;avance le format des données que l&#39;on va insérer dans la base, par exemple. Il est ainsi possible d&#39;insérer l&#39;objet <code>{Nom : &quot;Davis&quot;, Prénom : &quot;Miles&quot;}</code> puis l&#39;objet <code>{Nom : &quot;Parker&quot;, Prénom : &quot;Charlie&quot;, Lieu de naissance : &quot;Kansas City&quot;}</code> sans redéfinir la base en ajoutant un champ <code>Lieu de naissance</code>.  Une caractéristique particulièrement intéressante dans le cas de Gazouilloire : parmi la cinquantaine de champs potentiellement stockés par tweet (auteur, contenu, hashtags, ...), plusieurs ne seront pas présents dans tous les cas, comme la géolocalisation. MongoDB nous permet donc de stocker chaque tweet avec les informations qu&#39;il possède sans se soucier des champs qu&#39;il possède.</p><p>S&#39;il permet de stocker rapidement de grandes quantités de données, l&#39;accès à ces données en lecture (une fois stockées) est en revanche limité en vitesse. Cela est particulièrement vrai pour les requêtes d&#39;agrégation*. Une requête d&#39;agrégation va consister à grouper tous les enregistrements (ici, tweets) qui répondent à un critère : par exemple, qui datent du jour J. MongoDB n&#39;utilisant pas d&#39;indexation par défaut, cela nécessite de chercher dans toute la base les enregistrements correspondant.</p><p>Ce qui n&#39;est pas problématique si l&#39;on veut afficher une liste de 100 tweets, mais qui devient très handicapant lorsque l&#39;on souhaite afficher la distribution temporelle d&#39;un corpus de 2 millions de tweets.</p><p>Illustration sur une requête d&#39;agrégation temporelle destinée à afficher une courbe du nombre de tweets par jour, sur un corpus de 2 millions de tweets :</p><figure><table><thead><tr><th>MongoDB</th><th>Elasticsearch</th></tr></thead><tbody><tr><td>26,7 secondes</td><td>120 ms</td></tr></tbody></table></figure><p>Avec MongoDB et des corpus dépassant les centaines de milliers de documents, l&#39;interface devient inutilisable. Il était donc nécessaire de migrer vers une base de données Elasticsearch.</p><h5><a name='header-n1080' class='md-header-anchor '></a>Comment changer de base de données ?</h5><p><span>	</span><strong>Étape 1 - Identifer les différences de structure</strong></p><p>MongoDB possède une arborescence à 2 niveaux : on peut créer plusieurs <code>databases</code>, lesquelles contiennent une ou plusieurs <code>collections</code>. Dans Gazouilloire, une collecte correspond à une <code>database</code>, contenant une <code>collection</code> <em>&quot;tweets&quot;</em> et une collection <em>&quot;links&quot;</em> (stockant les liens contenus dans les tweets).</p><p>Elasticsearch ne fonctionne qu&#39;à un seul niveau, celui des <code>index</code> (équivalent des <code>databases</code> Mongo), sans sous-index ou équivalent des <code>collections</code>.</p><p>La solution retenue ici est de créer deux <code>index</code> pour chaque collecte :</p><p><img src='/home/jules/dev/medialabInternshipReport/data/collections_indices.png' alt='' referrerPolicy='no-referrer' /></p><p><span>	</span><strong>Étape 2 - Construire une base de données Elasticsearch</strong></p><p>Bien évidemment, il faut avant toute chose <a href='https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html'>installer Elasticsearch</a>, ainsi que son client Python (<code>pip install elasticsearch</code>) dans notre cas.</p><p>On souhaite se construire une base de données Elasticsearch contenant des tweets (sans avoir à migrer au préalable toute la machinerie de collecte), afin de tester le fonctionnement de l&#39;interface avec cette base.</p><p>L&#39;idéal est de réaliser un script requêtant tous les enregistrements de la Mongo et les indexant dans Elasticsearch, afin de construire une base de test identique à la Mongo, et ainsi de s&#39;assurer que les résultats des requêtes sont les mêmes quel que soit le type de base.</p><p>Il faut donc d&#39;abord créer un index Elasticsearch : </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">es</span>.<span class="cm-property">indices</span>.<span class="cm-property">create</span>(<span class="cm-variable">index</span>=<span class="cm-string">'test-index'</span>, <span class="cm-variable">body</span>=<span class="cm-variable">mappings</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>La variable <code>mappings</code> est importante : la bibliothèque sur laquelle est basée Elasticsearch, Lucene, a besoin de savoir comment lire les données qu&#39;elle stocke. Pour cela, il faut établir un <em>mapping</em> à la création de chaque index. Celui-ci définit, entre autres, le type de chaque champ de l&#39;index :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="json" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="json"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-string">"mappings"</span>: {</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"favorite_count"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"type"</span>: <span class="cm-string">"integer"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"timestamp"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"type"</span>: <span class="cm-string">"date"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"format"</span>: <span class="cm-string">"epoch_second"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"text"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"type"</span>: <span class="cm-string">"text"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-string cm-property">"lang"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string cm-property">"type"</span>: <span class="cm-string">"keyword"</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-meta">...</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 368px;"></div><div class="CodeMirror-gutters" style="display: none; height: 368px;"></div></div></div></pre><p>Les mappings sont déterminés automatiquement s&#39;ils ne sont pas spécifiés, mais cela menant souvent à des erreurs (entiers pris pour des chaînes de caractères par exemple), il est déconseillé de procéder ainsi.</p><blockquote><p>On notera aussi la différence entre les types <code>&quot;text&quot;</code> et <code>&quot;keyword&quot;</code> : les champs de type <code>text</code> sont analysés (découpés en une liste de termes individuels) avant d&#39;être indexés, ce qui permet ensuite de rechercher un mot en particulier <em>à l&#39;intérieur</em> du texte stocké. Il n&#39;est en revanche pas possible d&#39;effectuer de requête de tri ou d&#39;agrégation (grouper selon certains critères) sur un champ <code>text</code>, tandis que ça l&#39;est avec un champ <code>keyword</code> (qui lui n&#39;est pas analysé, donc pas recherchable autrement qu&#39;avec sa valeur exacte).</p></blockquote><blockquote><p>text analysis : fielddata, pas d&#39;agrégatino avec les champs text (SEARCH : quels docs contiennent ce terme ?, AGG/SORT : Quelle est la valeur de ce champ pour tel doc ?)</p></blockquote><p><span>	</span><strong>Étape 3 - Brancher l&#39;interface sur la base de test</strong></p><p>Pour que l&#39;interface puisse accéder aux données stockées dans Elasticsearch, il faut modifier le serveur Flask, en ajoutant des routes requêtant la base Elasticsearch.</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">es</span> = <span class="cm-variable">Elasticsearch</span>(<span class="cm-string">'http://HOST:PORT'</span>)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">@app</span>.<span class="cm-property">route</span>(<span class="cm-string">"/elastictimeevolution"</span>)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">def</span> <span class="cm-def">getDayCount</span>():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">data</span> = <span class="cm-variable">es</span>.<span class="cm-property">search</span>(<span class="cm-string">"REQUETE ELASTICSEARCH"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">make_response</span>(<span class="cm-variable">jsonify</span>(<span class="cm-variable">days</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 92px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p>A noter que la forme des réponses Mongo et Elasticsearch n&#39;étant pas les mêmes, il est souhaitable de formater les réponses dans le serveur pour qu&#39;on puisse utiliser indifféremment des résultats provenant de Mongo ou d&#39;Elasticsearch.</p><p>&nbsp;</p><p><span>	</span><strong>Étape 4 - Abstraire la base de données</strong></p><p>Afin d&#39;assurer une certaine lisibilité dans le code et la possibilité de choisir facilement entre une base Mongo ou Elasticsearch, a été fait le choix d&#39;abstraire la base de données. Abstraire la base de données, c&#39;est utiliser un objet générique - qu&#39;on peut appeler <code>Database</code>  - possédant les méthodes nécessaires au fonctionnement de Gazouilloire (<code>find</code>, <code>update</code>, <code>count</code> par exemple), et qui effectue les bonnes requêtes selon le type de base choisie.</p><p>Les deux classes n&#39;ayant que très peu de méthodes et attributs communs, l&#39;option d&#39;une classe abstraite dont hériteraient deux sous-classes n&#39;est pas réellement pertinente. Il a donc été fait le choix d&#39;implémenter deux classes <code>MongoManager</code> et <code>ElasticManager</code> indépendantes, mais possédant les mêmes méthodes.</p><p><img src='data/abstraction.png' alt='' referrerPolicy='no-referrer' /></p><p>Dans le script principal, il suffit alors d&#39;utiliser DBManager pour instancier une base de données du type souhaité (définie dans le fichier de configuration, ici <code>conf</code>) :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">db</span> = <span class="cm-variable">db_manager</span>(<span class="cm-variable">conf</span>[<span class="cm-string">'database'</span>])</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">db</span>.<span class="cm-property">update</span>(<span class="cm-variable">tweet</span>, <span class="cm-variable">value</span>) <span class="cm-comment"># Utilise la requête d'update adéquate</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>Il reste à écrire les méthodes de chaque classe, avec les requêtes adéquates.</p><p><span>	</span><strong>Étape 5 - Optimiser les performances</strong></p><blockquote><p>bulk indexing</p><p>heap size</p></blockquote><p>Afin d&#39;optimiser la vitesse d&#39;indexation, il est possible d&#39;effectuer les requêtes par paquets (<em>bulk_indexing</em>).</p><p>Avec le client Python, l&#39;idéal est d&#39;avoir un générateur de requêtes : </p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> <span class="cm-keyword">def</span> <span class="cm-def">stream_tweets</span>(<span class="cm-variable">tweets</span>, <span class="cm-variable">index</span>):</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"""Yields an update action for every tweet of a list"""</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">tweet</span> <span class="cm-keyword">in</span> <span class="cm-variable">tweets</span>:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">yield</span> {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"_id"</span>: <span class="cm-variable">tweet</span>[<span class="cm-string">"_id"</span>],</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"_type"</span>: <span class="cm-string">"tweet"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"_index"</span>: <span class="cm-variable">index</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"_op_type"</span>: <span class="cm-string">"update"</span>,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"_source"</span>: {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-string">"doc"</span>: <span class="cm-variable">format_tweet_fields</span>(<span class="cm-variable">tweet</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 276px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p>Ici, <code>stream_tweets</code> génère une requête mettant à jour l&#39;enregistrement correspondant à l&#39;id spécifié avec le contenu fourni (préalablement formaté) pour chaque tweet dans <code>tweets</code>. Il suffit ensuite d&#39;utiliser ce générateur de requêtes dans un <code>streaming_bulk</code> :</p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="python"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 8px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">elasticsearch</span> <span class="cm-keyword">import</span> <span class="cm-variable">helpers</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">es</span> = <span class="cm-variable">Elasticsearch</span>(<span class="cm-string">"HOST:PORT"</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">tweets_collectes</span> = [<span class="cm-variable">tweet1</span>, <span class="cm-variable">tweet2</span>, <span class="cm-variable">tweet3</span>, ...]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">helpers</span>.<span class="cm-property">streaming_bulk</span>(<span class="cm-variable">es</span>, <span class="cm-variable">actions</span>=<span class="cm-variable">stream_tweets</span>(<span class="cm-variable">tweets_collectes</span>))</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 161px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p>Problèmes de vitesse mis à part, la quantité d&#39;informations stockées doit aussi être prise en compte. Un outil de collecte comme Gazouilloire peut facilement être amené à collecter 1, 10 voire 100 millions de tweets, ce qui représente plusieurs dizaines voire centaines de gigas. <em>Lucene*</em>, et donc Elasticsearch, fonctionne en Java ; pour de très gros corpus, il est nécessaire de modifier sa configuration par défaut. Cela concerne en particulier la taille de la mémoire virtuelle Java (ou <em>JVM heap size</em>), qui sature si le corpus est trop important :</p><p><img src='data/JVM_heap_size.png' alt='' referrerPolicy='no-referrer' /></p><p>Par défaut à 1GB, il faut augmenter sa valeur pour des corpus de plus de 15 millions (cela se fait dans le fichier <code>/etc/elasticsearch/jvm.options</code> ).</p><blockquote><p>Réseau de tweets : <a href='https://mail.google.com/mail/u/1/#search/jeanphilippe.cointet%40sciencespo.fr/FMfcgxvzKbVkNHcsdwmSfplLpRGNcDvg' target='_blank' class='url'>https://mail.google.com/mail/u/1/#search/jeanphilippe.cointet%40sciencespo.fr/FMfcgxvzKbVkNHcsdwmSfplLpRGNcDvg</a></p><p>Rapport polarisation : <a href='https://docs.google.com/document/d/1IGq7wKhK-3mAitTN8g0NxLY3Zyi_7ubbLQ9RuqJknMk/edit?ts=5b31e7ec' target='_blank' class='url'>https://docs.google.com/document/d/1IGq7wKhK-3mAitTN8g0NxLY3Zyi_7ubbLQ9RuqJknMk/edit?ts=5b31e7ec</a> </p></blockquote><h5><a name='header-n1128' class='md-header-anchor '></a>Les avantages d&#39;Elasticsearch : Kibana</h5><p>Outre les points de performance évoqués plus haut, un des points forts d&#39;Elasticsearch est le fait qu&#39;on puisse lui joindre <a href='https://www.elastic.co/fr/products/kibana'>Kibana</a>, le greffon de visualisation de données de la suite Elastic. Cela facilite grandement l&#39;exploration de données, ainsi que le monitoring de chaque index.</p><h3><a name='header-n1130' class='md-header-anchor '></a>3.1.2 Facebook</h3><p>SI le laboratoire dispose d&#39;un outil bien établi pour la collecte de tweets, ce n&#39;est pas le cas pour la collecte de données Facebook. Twitter étant moins utilisé que Facebook,et pas forcément représentatif de la population, la question d&#39;un biais dans les données récoltées se pose. Pour réduire celui-ci, ou du moins évaluer les différences entre les métriques de partage sur Facebook et sur Twitter, il est intéressant de pouvoir récupérer le nombre de partage Facebook pour telle url.</p><h4><a name='header-n1132' class='md-header-anchor '></a>3.1.2.1 La méthode utilisant l&#39;API</h4><p>Facebook fournit la <a href='https://developers.facebook.com/docs/graph-api/'>Graph API</a>, principal point d&#39;entrée des développeurs souhaitant lire (ou écrire) des données Facebook. Utiliser l&#39;API nécessite un compte développeur Facebook, qui fournit les clés <em>App ID</em> et <em>App Secret</em>, utilisées pour effectuer les requêtes. </p><p>Le but ici est de récupérer les données d&#39;activité pour un lien partagé sur le réseau, ce qui est possible via la <a href='https://developers.facebook.com/docs/graph-api/reference/v3.2/url'>section URL</a> de la Graph API. Ainsi, la requête suivante permet de récupérer le nombre de réactions, de commentaires, de partages et de commentaires externes pour une url donnée :</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="bash" contenteditable="false" cid="n1135" mdtype="fences">curl -i -X GET \
	https://graph.facebook.com/v3.1/?id=URL&amp;fields=FIELDS&amp;access_token=ACCESSTOKEN
</pre><blockquote><p>Un <code>ACCESSTOKEN</code> permanent peut être généré grâce aux clés du compte développeur : <code>ACCESSTOKEN</code> = <code>APPID|SECRETKEY</code>. Le champ  <code>FIELDS</code>  permet lui de spécifier les informations que l&#39;on souhaite obtenir, dans notre cas <code>FIELDS</code> = <code>&quot;engagement&quot;</code>.</p></blockquote><p>La réponse obtenue est de la forme suivante :</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="json" contenteditable="false" cid="n1139" mdtype="fences">{
  "engagement": {
    "reaction_count": 45315,
    "comment_count": 31742,
    "share_count": 25671,
    "comment_plugin_count": 3
  },
  "id": "https://www.imdb.com/title/tt0166924/"
}
</pre><p>Problème majeur de cette approche : les limitations en terme de nombre de requêtes imposées par l&#39;API.</p><p>Après plusieurs essais, il apparaît que la <em>rate limit</em> se trouve à un peu moins d&#39;<strong>une requête toutes les 15 secondes</strong>, ce qui est extrêmement lent et totalement rédhibitoire pour tout usage massif. Pour illustration, il faudrait <em>3,5 jours</em> pour récupérer les données de 10 000 urls, quand certains corpus de recherche se comptent plutôt en centaines de milliers d&#39;entrées.</p><p>En outre, l&#39;API est assez rigide sur l&#39;url entrée en paramètre : si l&#39;on veut être exhaustif, il faut faire la requête à la fois sur la page en http et la page en https, le résultat renvoyé n&#39;étant pas le même. De même, les résultats diffèrent en fonction de la présence d&#39;un  <code>/</code> final ou non.</p><h4><a name='header-n1143' class='md-header-anchor '></a>3.1.2.2 La méthode contournant l&#39;API</h4><p>Il a fallu trouver une alternative à l&#39;usage conventionnel de l&#39;API. Celle-ci se trouve dans le détournement du bouton &quot;Like&quot; destiné aux pages web tierces :</p><p><img src='data/facebook_button.png' alt='' referrerPolicy='no-referrer' /></p><p>On y accède via l&#39;url suivante :</p><pre spellcheck="false" class="md-fences mock-cm md-end-block" lang="" contenteditable="false" cid="n1147" mdtype="fences">https://www.facebook.com/plugins/like.php?href=URL&amp;layout=box_count
</pre><blockquote><p>À garder en tête, l&#39;url cible (<code>URL</code>) doit être encodée avant d&#39;être insérée dans l&#39;adresse ci-dessus. Cet encodage peut se faire avec <code>quote</code> d&#39;<code>urllib.parse</code> en Python, ou avec <code>encodeURI</code> en Javascript.</p></blockquote><p>Il suffit alors de scraper la valeur du bouton et de la convertir en <code>integer</code> pour avoir le nombre de partages (arrondi) de l&#39;url voulue. Et surtout, il n&#39;y a pas de limites de requêtes (ce n&#39;est pas dans l&#39;intérêt de Facebook de limiter la diffusion de son réseau social sur les sites tiers) : la seule limite est celle de la connexion.</p><h2><a name='header-n1151' class='md-header-anchor '></a>3.2 Traiter</h2><p>Collecter des données c&#39;est bien, encore faut-il que celles-ci soient exploitable.</p><p>Pour les tweets, l&#39;API de Twitter fournit des données propres et ordonnées, qu&#39;il est facile d&#39;utiliser dans Gazouilloire. Pour Facebook, les deux méthodes donnent des résultats sous forme d&#39;entiers, parfaitement exploitables. Les problèmes potentiels se situent au niveau des urls pour lesquelles on applique les scripts de collecte. </p><p>Mettons-nous à la place du chercheur en sciences sociales souhaitant collecter des données de partage Facebook pour un corpus de liens sur un sujet en particulier. Celui-ci n&#39;ayant potentiellement que des compétences de base en informatique, la façon dont les urls seront entrées ne sera pas forcément adaptée (càd uniforme et cohérente). </p><h3><a name='header-n1155' class='md-header-anchor '></a>3.2.1 Normalisation des urls</h3><blockquote><p>utilité</p><p>architecture</p><p>tests unitaires</p><p>ural fonctions</p><p>CLI</p><p>lruTRIE</p><p>join</p></blockquote><h3><a name='header-n1164' class='md-header-anchor '></a>3.2.2 Extraction du contenu pertinent d&#39;une page web</h3><p>Une des problématiques récurrentes rencontrée par les chercheurs du laboratoire consiste en l&#39;analyse du contenu d&#39;un corpus de pages web.</p><p>Mettons-nous à la place d&#39;un chercheur souhaitant analyser un ensemble d&#39;articles de presse traitant de la santé, pour pouvoir ensuite les trier par sujet et identifier quelle page traite du glyphosate, des compteurs Linky ou des cabines à UV. Une première question d&#39;ordre technique se pose : notre chercheur, face à sa liste de 10 000 urls, doit d&#39;abord récupérer le contenu texte des articles, mais n&#39;est pas très enthousiaste à l&#39;idée de visiter chaque page et de copier son contenu à la main. Heureusement, cela s&#39;automatise. Mais l&#39;automatisation n&#39;est pas évidente : comment notre programme fait-il la différence entre le contenu de l&#39;article et les commentaires, l&#39;en-tête du site, la liste des catégories ? Si encore tous les sites web avaient la même structure, on aurait pu établir des règles génériques (identifier la balise HTML contenant le texte). C&#39;est évidemment loin d&#39;être le cas.</p><p>La problématique d&#39;extraction de contenu texte à partir de HTML étant récurrente, il existe différents outils open-source y répondant, fonctionnant pour la plupart à l&#39;aide d&#39;heuristiques : Goose, Boilerpipe, eatiht, Dragnet, libextract... Mais quelle est la librairie la plus performante ?</p><p>L&#39;évaluation automatisée des performances de tels outils est difficile à mettre en oeuvre puisqu&#39;il n&#39;y a pas de moyen simple de déterminer si le contenu extrait est bien le texte de l&#39;article ou non. On peut évidemment établir une liste d&#39;heuristiques se basant sur des mots-clés (&quot;Error 404&quot;, &quot;Cloudflare&quot; ...) ou sur la taille du résultat, mais cela n&#39;écarte que les cas d&#39;échec les plus simples et nécessite tout de même un certain temps à mettre en place. Une alternative simple consiste donc à implémenter toutes les librairies dans un script Python affichant le résultat des différentes extractions, pour un fichier HTML tiré au hasard. En donnant un score (la notation étant forcément subjective mais commune) à chaque méthode, </p><p>&nbsp;</p><p>J&#39;ai donc implémenté les différents outils dans un script Python affichant les résultats des différentes extractions, pour un fichier HTML tiré au hasard, afin d&#39;évaluer rapidement la qualité des résultats.</p><p>Pour déterminer cela, j&#39;ai téléchargé le HTML brut d&#39;un corpus d&#39;urls issus d&#39;un travail de recherche, pour constituer un ensemble de pages sur lesquelles tester ces librairies. </p><p><img src='data/benchmark_results.png' alt='Image of Yaktocat' referrerPolicy='no-referrer' /></p><p>-&gt; Multithreading </p><p> </p><h3><a name='header-n1175' class='md-header-anchor '></a>Minet</h3><figure><table><thead><tr><th>url</th></tr></thead><tbody><tr><td>url1.com/bidule</td></tr><tr><td>url2.com/truc</td></tr><tr><td>url3.com/machin</td></tr></tbody></table></figure><p>-&gt; javascript : bien plus pratique à packager (electron), possibilité d&#39;utiliser du chrome headless très simplement, mais pas de text extraction et tout</p><h1><a name='header-n1186' class='md-header-anchor '></a>Conclusion</h1><blockquote><p><em>La conclusion devrait faire de une à deux pages.
En général, on commence par présenter un résumé du rapport puis les perspectives et éventuellement les travaux restant à mener.
Vous pouvez ensuite exposer les points positifs et négatifs de votre stage.
Enfin, vous pouvez re-situer votre stage dans votre parcours de formation et dans votre projet professionnel. Vos objectifs ont-ils évolué ? Par exemple, en quoi ce stage confirme (ou infirme) votre choix de filière ?</em></p></blockquote><p>==&gt; collaboration avec Benkler / Zuckermann ?</p><h1><a name='header-n1190' class='md-header-anchor '></a>Bibliographie</h1><p><a href='https://stph.scenari-community.org/contribs/nos/es3/co/es3.html' target='_blank' class='url'>https://stph.scenari-community.org/contribs/nos/es3/co/es3.html</a> </p><p>&nbsp;</p><h1><a name='header-n1193' class='md-header-anchor '></a>Glossaire</h1><p><strong>Requête d&#39;agrégation</strong> :</p><p><strong>Breaking change</strong> :</p><p><strong>DOM (Document Object Model)</strong> :  </p><p><strong>Clone (git)</strong> :</p><p><strong>Git</strong> : </p><p><strong>Pull request (git)</strong> :</p><p><strong>Responsive</strong> : un site est <em>responsive</em> lorsque son contenu s&#39;adapte automatiquement à la résolution du terminal utilisé pour le visionner. De nos jours, la quasi-totalité des sites sont <em>responsive</em>.</p><p><strong>Test unitaire</strong> :</p><p>&nbsp;</p><div style="page-break-after: always;"></div><h1><a name='header-n1204' class='md-header-anchor '></a>Annexes</h1></div>
</body>
</html>